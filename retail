import pandas as pd

# Define the CUSIP order
cusip_order = [
    "BRW9GEFT9", "BRWU07BP6", "BRWX9VF25", "SBJFVF832", "BRTYX23T8",
    "BRTQLBL92", "BRWX9Y4G0", "BRWX9WDZ2", "BRSHXH3E6", "BRWX9U858",
    "BRSEM7J75", "BRSEM7H93", "BRSDVN4P8", "BRYGA7Q11", "BRYGC1JX0",
    "BRWL6SDX5", "SBF553834", "BRTKWG434", "BRSEM7HS1"
]

# Initialize an empty DataFrame for the final result
final_df = pd.DataFrame()

# Load the Excel file
excel_file = pd.ExcelFile("ucitoutput.xlsx")

# Process each sheet
for sheet_name in excel_file.sheet_names:
    # Read the sheet into a DataFrame
    df = pd.read_excel(excel_file, sheet_name=sheet_name)
    
    # Ensure 'cusip' is a string to avoid any numeric issues
    df['cusip'] = df['cusip'].astype(str)
    
    # Create a DataFrame with all cusips in the order with 'pct_mv' default to 0
    ordered_df = pd.DataFrame(cusip_order, columns=['cusip'])
    ordered_df['pct_mv'] = 0
    
    # Merge the original data into the ordered DataFrame
    ordered_df = pd.merge(ordered_df, df[['cusip', 'pct_mv']], on='cusip', how='left', suffixes=('', '_orig'))
    
    # Fill NaN values in 'pct_mv' from the original data with 0
    ordered_df['pct_mv'] = ordered_df['pct_mv_orig'].fillna(0)
    
    # Drop the '_orig' column used for merging
    ordered_df.drop(columns=['pct_mv_orig'], inplace=True)
    
    # Set the 'cusip' as the index
    ordered_df.set_index('cusip', inplace=True)
    
    # Add the 'pct_mv' column to the final DataFrame
    final_df[sheet_name] = ordered_df['pct_mv']

# Reset the index for the final DataFrame
final_df.reset_index(drop=True, inplace=True)

# Save the final DataFrame to a CSV file
final_df.to_csv('output.csv', index=False)
